<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Concrete PM - Buyout Manager</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header {
            background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%);
            color: white;
            padding: 20px 30px;
            margin-bottom: 30px;
            border-radius: 10px;
        }
        h1 { font-size: 1.8rem; margin-bottom: 5px; }
        .subtitle { opacity: 0.9; }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab {
            padding: 12px 24px;
            background: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .tab:hover { background: #e8f4fc; }
        .tab.active { background: #2d5a87; color: white; }
        .panel {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: none;
        }
        .panel.active { display: block; }
        h2 { color: #1e3a5f; margin-bottom: 20px; }
        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.2s;
        }
        .btn-primary { background: #2d5a87; color: white; }
        .btn-primary:hover { background: #1e3a5f; }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #218838; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-danger:hover { background: #c82333; }
        .btn-sm { padding: 6px 12px; font-size: 0.85rem; }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        th { background: #f8f9fa; font-weight: 600; }
        tr:hover { background: #f8f9fa; }
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }
        .badge-concrete { background: #cce5ff; color: #004085; }
        .badge-rebar { background: #d4edda; color: #155724; }
        .badge-formwork { background: #fff3cd; color: #856404; }
        .badge-admixture { background: #f8d7da; color: #721c24; }
        .badge-curing { background: #d1ecf1; color: #0c5460; }
        .badge-accessories { background: #e2e3e5; color: #383d41; }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal.show { display: flex; }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .modal-header h3 { color: #1e3a5f; }
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        .form-group textarea { min-height: 80px; resize: vertical; }
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        .empty-state h3 { margin-bottom: 10px; }
        .search-box {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 300px;
        }
        .back-link { color: white; text-decoration: none; opacity: 0.8; }
        .back-link:hover { opacity: 1; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">‚Üê Back to Oncor</a>
            <h1>‚ö° Concrete PM - Buyout Manager</h1>
            <p class="subtitle">Products, Suppliers & Procurement Tracking</p>
        </header>

        <div class="tabs">
            <button class="tab active" data-panel="products">üì¶ Products</button>
            <button class="tab" data-panel="suppliers">üè≠ Suppliers</button>
            <button class="tab" data-panel="buyout">üìã Project Buyout</button>
        </div>

        <!-- Products Panel -->
        <div class="panel active" id="products">
            <div class="toolbar">
                <h2>Product Database</h2>
                <div>
                    <input type="text" class="search-box" id="productSearch" placeholder="Search products...">
                    <button class="btn btn-primary" onclick="showAddProduct()">+ Add Product</button>
                </div>
            </div>
            <table id="productsTable">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Product Name</th>
                        <th>Unit</th>
                        <th>Spec/Standard</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="productsBody"></tbody>
            </table>
            <div class="empty-state" id="productsEmpty">
                <h3>No products yet</h3>
                <p>Add your first product to get started</p>
            </div>
        </div>

        <!-- Suppliers Panel -->
        <div class="panel" id="suppliers">
            <div class="toolbar">
                <h2>Supplier Database</h2>
                <div>
                    <input type="text" class="search-box" id="supplierSearch" placeholder="Search suppliers...">
                    <button class="btn btn-primary" onclick="showAddSupplier()">+ Add Supplier</button>
                </div>
            </div>
            <table id="suppliersTable">
                <thead>
                    <tr>
                        <th>Company Name</th>
                        <th>Contact</th>
                        <th>Phone</th>
                        <th>Categories</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="suppliersBody"></tbody>
            </table>
            <div class="empty-state" id="suppliersEmpty">
                <h3>No suppliers yet</h3>
                <p>Add your first supplier to get started</p>
            </div>
        </div>

        <!-- Buyout Panel -->
        <div class="panel" id="buyout">
            <div class="toolbar">
                <h2>Project Buyout</h2>
                <button class="btn btn-primary" onclick="showAddBuyoutItem()">+ Add Item</button>
            </div>
            <table id="buyoutTable">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Quantity</th>
                        <th>Supplier</th>
                        <th>Status</th>
                        <th>Price</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="buyoutBody"></tbody>
            </table>
            <div class="empty-state" id="buyoutEmpty">
                <h3>No buyout items</h3>
                <p>Add materials from your project specs</p>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="productModalTitle">Add Product</h3>
                <button class="close-btn" onclick="closeModal('productModal')">&times;</button>
            </div>
            <form id="productForm" onsubmit="saveProduct(event)">
                <input type="hidden" id="productId">
                <div class="form-group">
                    <label>Category</label>
                    <select id="productCategory" required>
                        <option value="">Select category...</option>
                        <option value="concrete">Concrete</option>
                        <option value="rebar">Rebar</option>
                        <option value="mesh">Mesh/WWF</option>
                        <option value="formwork">Formwork</option>
                        <option value="admixture">Admixtures</option>
                        <option value="curing">Curing</option>
                        <option value="accessories">Accessories</option>
                        <option value="grout">Grout</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Product Name</label>
                    <input type="text" id="productName" required placeholder="e.g., Ready-Mix 4000 PSI">
                </div>
                <div class="form-group">
                    <label>Unit of Measure</label>
                    <select id="productUnit" required>
                        <option value="CY">CY (Cubic Yards)</option>
                        <option value="TON">TON</option>
                        <option value="LF">LF (Linear Feet)</option>
                        <option value="SF">SF (Square Feet)</option>
                        <option value="EA">EA (Each)</option>
                        <option value="GAL">GAL (Gallons)</option>
                        <option value="LB">LB (Pounds)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Spec/Standard</label>
                    <input type="text" id="productSpec" placeholder="e.g., ASTM C94, ACI 318">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" onclick="closeModal('productModal')">Cancel</button>
                    <button type="submit" class="btn btn-success">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Supplier Modal -->
    <div class="modal" id="supplierModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="supplierModalTitle">Add Supplier</h3>
                <button class="close-btn" onclick="closeModal('supplierModal')">&times;</button>
            </div>
            <form id="supplierForm" onsubmit="saveSupplier(event)">
                <input type="hidden" id="supplierId">
                <div class="form-group">
                    <label>Company Name</label>
                    <input type="text" id="supplierName" required placeholder="e.g., Martin Marietta">
                </div>
                <div class="form-group">
                    <label>Contact Name</label>
                    <input type="text" id="supplierContact" placeholder="e.g., John Smith">
                </div>
                <div class="form-group">
                    <label>Phone</label>
                    <input type="tel" id="supplierPhone" placeholder="(915) 555-0100">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="supplierEmail" placeholder="john@supplier.com">
                </div>
                <div class="form-group">
                    <label>Categories (select multiple)</label>
                    <select id="supplierCategories" multiple style="height: 120px;">
                        <option value="concrete">Concrete</option>
                        <option value="rebar">Rebar</option>
                        <option value="mesh">Mesh/WWF</option>
                        <option value="formwork">Formwork</option>
                        <option value="admixture">Admixtures</option>
                        <option value="curing">Curing</option>
                        <option value="accessories">Accessories</option>
                        <option value="grout">Grout</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="supplierNotes" placeholder="Any notes about this supplier..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" onclick="closeModal('supplierModal')">Cancel</button>
                    <button type="submit" class="btn btn-success">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Data storage
        let products = JSON.parse(localStorage.getItem('cpm_products') || '[]');
        let suppliers = JSON.parse(localStorage.getItem('cpm_suppliers') || '[]');
        let buyoutItems = JSON.parse(localStorage.getItem('cpm_buyout') || '[]');

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.panel).classList.add('active');
            });
        });

        // Modal functions
        function showModal(id) {
            document.getElementById(id).classList.add('show');
        }
        function closeModal(id) {
            document.getElementById(id).classList.remove('show');
        }

        // Product functions
        function showAddProduct() {
            document.getElementById('productModalTitle').textContent = 'Add Product';
            document.getElementById('productForm').reset();
            document.getElementById('productId').value = '';
            showModal('productModal');
        }

        function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;
            document.getElementById('productModalTitle').textContent = 'Edit Product';
            document.getElementById('productId').value = id;
            document.getElementById('productCategory').value = product.category;
            document.getElementById('productName').value = product.name;
            document.getElementById('productUnit').value = product.unit;
            document.getElementById('productSpec').value = product.spec || '';
            showModal('productModal');
        }

        function saveProduct(e) {
            e.preventDefault();
            const id = document.getElementById('productId').value || Date.now().toString();
            const product = {
                id,
                category: document.getElementById('productCategory').value,
                name: document.getElementById('productName').value,
                unit: document.getElementById('productUnit').value,
                spec: document.getElementById('productSpec').value
            };
            
            const existingIndex = products.findIndex(p => p.id === id);
            if (existingIndex >= 0) {
                products[existingIndex] = product;
            } else {
                products.push(product);
            }
            
            localStorage.setItem('cpm_products', JSON.stringify(products));
            closeModal('productModal');
            renderProducts();
        }

        function deleteProduct(id) {
            if (!confirm('Delete this product?')) return;
            products = products.filter(p => p.id !== id);
            localStorage.setItem('cpm_products', JSON.stringify(products));
            renderProducts();
        }

        function renderProducts() {
            const tbody = document.getElementById('productsBody');
            const empty = document.getElementById('productsEmpty');
            const search = document.getElementById('productSearch').value.toLowerCase();
            
            const filtered = products.filter(p => 
                p.name.toLowerCase().includes(search) || 
                p.category.toLowerCase().includes(search)
            );
            
            if (filtered.length === 0) {
                tbody.innerHTML = '';
                empty.style.display = 'block';
                return;
            }
            
            empty.style.display = 'none';
            tbody.innerHTML = filtered.map(p => `
                <tr>
                    <td><span class="badge badge-${p.category}">${p.category}</span></td>
                    <td>${p.name}</td>
                    <td>${p.unit}</td>
                    <td>${p.spec || '-'}</td>
                    <td>
                        <button class="btn btn-sm" onclick="editProduct('${p.id}')">Edit</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteProduct('${p.id}')">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        // Supplier functions
        function showAddSupplier() {
            document.getElementById('supplierModalTitle').textContent = 'Add Supplier';
            document.getElementById('supplierForm').reset();
            document.getElementById('supplierId').value = '';
            showModal('supplierModal');
        }

        function editSupplier(id) {
            const supplier = suppliers.find(s => s.id === id);
            if (!supplier) return;
            document.getElementById('supplierModalTitle').textContent = 'Edit Supplier';
            document.getElementById('supplierId').value = id;
            document.getElementById('supplierName').value = supplier.name;
            document.getElementById('supplierContact').value = supplier.contact || '';
            document.getElementById('supplierPhone').value = supplier.phone || '';
            document.getElementById('supplierEmail').value = supplier.email || '';
            document.getElementById('supplierNotes').value = supplier.notes || '';
            
            const select = document.getElementById('supplierCategories');
            Array.from(select.options).forEach(opt => {
                opt.selected = (supplier.categories || []).includes(opt.value);
            });
            
            showModal('supplierModal');
        }

        function saveSupplier(e) {
            e.preventDefault();
            const id = document.getElementById('supplierId').value || Date.now().toString();
            const select = document.getElementById('supplierCategories');
            const categories = Array.from(select.selectedOptions).map(opt => opt.value);
            
            const supplier = {
                id,
                name: document.getElementById('supplierName').value,
                contact: document.getElementById('supplierContact').value,
                phone: document.getElementById('supplierPhone').value,
                email: document.getElementById('supplierEmail').value,
                categories,
                notes: document.getElementById('supplierNotes').value
            };
            
            const existingIndex = suppliers.findIndex(s => s.id === id);
            if (existingIndex >= 0) {
                suppliers[existingIndex] = supplier;
            } else {
                suppliers.push(supplier);
            }
            
            localStorage.setItem('cpm_suppliers', JSON.stringify(suppliers));
            closeModal('supplierModal');
            renderSuppliers();
        }

        function deleteSupplier(id) {
            if (!confirm('Delete this supplier?')) return;
            suppliers = suppliers.filter(s => s.id !== id);
            localStorage.setItem('cpm_suppliers', JSON.stringify(suppliers));
            renderSuppliers();
        }

        function renderSuppliers() {
            const tbody = document.getElementById('suppliersBody');
            const empty = document.getElementById('suppliersEmpty');
            const search = document.getElementById('supplierSearch').value.toLowerCase();
            
            const filtered = suppliers.filter(s => 
                s.name.toLowerCase().includes(search)
            );
            
            if (filtered.length === 0) {
                tbody.innerHTML = '';
                empty.style.display = 'block';
                return;
            }
            
            empty.style.display = 'none';
            tbody.innerHTML = filtered.map(s => `
                <tr>
                    <td><strong>${s.name}</strong></td>
                    <td>${s.contact || '-'}</td>
                    <td>${s.phone || '-'}</td>
                    <td>${(s.categories || []).map(c => `<span class="badge badge-${c}">${c}</span>`).join(' ')}</td>
                    <td>
                        <button class="btn btn-sm" onclick="editSupplier('${s.id}')">Edit</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteSupplier('${s.id}')">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        // Search handlers
        document.getElementById('productSearch').addEventListener('input', renderProducts);
        document.getElementById('supplierSearch').addEventListener('input', renderSuppliers);

        // Initial render
        renderProducts();
        renderSuppliers();

        // Seed sample data if empty
        if (products.length === 0) {
            products = [
                { id: '1', category: 'concrete', name: 'Ready-Mix 3000 PSI', unit: 'CY', spec: 'ASTM C94' },
                { id: '2', category: 'concrete', name: 'Ready-Mix 4000 PSI', unit: 'CY', spec: 'ASTM C94' },
                { id: '3', category: 'concrete', name: 'Ready-Mix 5000 PSI', unit: 'CY', spec: 'ASTM C94' },
                { id: '4', category: 'rebar', name: '#4 Rebar Grade 60', unit: 'TON', spec: 'ASTM A615' },
                { id: '5', category: 'rebar', name: '#5 Rebar Grade 60', unit: 'TON', spec: 'ASTM A615' },
                { id: '6', category: 'mesh', name: 'WWF 6x6 W2.9', unit: 'SF', spec: 'ASTM A185' },
                { id: '7', category: 'admixture', name: 'Water Reducer Type A', unit: 'GAL', spec: 'ASTM C494' },
                { id: '8', category: 'curing', name: 'Curing Compound', unit: 'GAL', spec: 'ASTM C309' },
            ];
            localStorage.setItem('cpm_products', JSON.stringify(products));
            renderProducts();
        }
    </script>
</body>
</html>
